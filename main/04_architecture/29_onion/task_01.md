# オニオンアーキテクチャとは

### DomainModel (Entity)｜実クラス

- ビジネスロジックを表現するオブジェクトが所属する
- 状態と振る舞いを持つモデル

### DomainService ｜インターフェイス・レポジトリ

- 状態を持たない
- ドメインモデル内で定義されたオブジェクトを利用した振る舞いを持つ
- ユビキタス言語に基づくことが前提の振る舞い、ロジック

### ApplicationService (UseCases）｜実クラス・レポジトリ

- 「ソフトウェアが何ができるのか」を表現する
- ユースケースに応じてドメイン層のオブジェクトを組み合わせて呼び出す
- ドメインの解釈や表現は行わない
- ドメイン層からインフラ層への物理的制約を排除する
- ドメイン層からインフラ層へアクセスするために経由する
- コンストラクタ等を通じて、具象クラスのオブジェクトが注入される

### その他諸々（UI,インフラ、テスト）

- アプリケーション外の実装（FW,DB などのミドルウェア含む）

# オニオンアーキテクチャを図解

https://qiita.com/cocoa-maemae/items/e3f2eabbe0877c2af8d0

# ドメインモデルがどこにも依存しないメリット

- 安定依存の原則に準拠できるので、ビジネスロジックがよりローレベルのコード変更や、FW＆ドライバ変更の影響を受けなくなること

### 他レイヤーへ依存するときインターフェースに対する依存のみ許可するメリット

- 根幹のビジネスロジックに対して修正を加える必要がなくなる（影響が及ばない）
  - 結果的にテストが容易になる
  - インフラ層の交換容易性につながる

# 「依存性の逆転」がどう使われているか

- 前身の伝統的なレイヤードアーキテクチャでは、ドメイン層がインフラ層に依存しており、設計上「安定依存の原則」に反していた
- オニオンアーキテクチャでは、ドメイン層がインフラ層に依存しなくなっている

## 特定のユーザにしかリソースの追加や更新を許さないようなアクセス制限機能を実装したい場合、どの層に記述するのが適切か

- DomainModel 層はどうか？
  - ユーザー＝モデルの一つ
  - 「特定のユーザー」はユーザーという概念に包括されるため、内部分岐は不適切のように思う
  - 別モデル「管理者」が爆誕してよければここでもいい
    - ただしその場合、一般ユーザーと特定ユーザーの間に「状態」と「振る舞い」、それぞれどの程度の違いがあるのかによると思う
- DomainService 層はどうか？
  - 定義：ユビキタス言語に基づいていることが前提の振る舞い、ロジック
    - ビジネス上の知識が単に振る舞いになっている
  - 設問の仕様は「振る舞い」と言えるか？
    - 振る舞いではなくバリデーションではないか？
- ApplicationService 層がよさそう
  - 定義：ビジネスロジックそのものではない（ドメインやインフラのやるべき作業を調整する）
  - 僕は今回のようなライトな調整であればここでいいと思う！！！！
