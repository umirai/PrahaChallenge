# 1. 用語説明

AWS ではデフォルトで全ての操作が禁止されているとイメージする。IAM を使って一つずつ操作を許可していくイメージ！

ポリシーでアクセス制御を定義・管理する。ポリシーはユーザーや、グループや、ロールにアタッチする。

ユーザーはアカウントのようなもので、グループはその集合。ロールは後述・・・

## IAM ユーザー

[IAM ユーザー](https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_users.html)

- AWS で作成するエンティティ
- AWS とやり取りするためにこれを使用するユーザーまたはアプリケーションのこと

## IAM グループ

[IAM ユーザーグループ](https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_groups.html)

- IAM ユーザーの集合
- 複数ユーザーに対してアクセス許可を指定したり、管理できる
  - ただし正式な認証情報としては取り扱われずあくまで一括管理できる便利なものという位置付け（＝プリンシパルとして認識されない）

## IAM ポリシー

[IAM でのポリシーとアクセス許可](https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/access_policies.html)

- IAM アイデンティティ（ユーザー、グループ、ロールなど）もしくは AWS リソースにアタッチするアクセス権限の定義
  - AWS 管理ポリシー：デフォルトで用意してくれているポリシー
  - カスタマー管理ポリシー：自前で詳細に定義できるポリシー
- JSON 形式で記述する
- アイデンティティベースのポリシーとリソースベースのポリシーがある
  - クロスアカウントで運用する際など、操作する側、される側どちらにも権限の付与が必要な場合は、リソースベースのポリシーを使用する場合がある

## IAM ロール

[IAM ロール](https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_roles.html)

- IAM ユーザーとの違い
  - 短期的な認証情報であり必要なときにしようされるもの
  - アクセスキーといった情報を持たない
- 例 1
  1. EC2 を削除できる権限（ロール A）を作成する
  2. 一次的にユーザー A に「ロール A にスイッチできる権限」を与える
  3. ユーザー A は EC2 を削除できる
- 例 2
  1. S3 に書き込みできる権限（ロール B）を作成する
  2. 一次的に EC2 インスタンスに「ロール B にスイッチできる権限」を与える
  3. EC2 インスタンスは S3 に書き込みができる
- つまり 2 つの側面がある
  - Trust: 誰がこのロールを assume できるか
  - Permission: このロールを assume した後何ができるか

## Permission Boundary（アクセス許可境界）

[IAM エンティティのアクセス許可境界](https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/access_policies_boundaries.html)

[IAM アクセス許可の境界で IAM ロールの権限を制御する](https://www.yamamanx.com/iam-permission-boundary-role/)

[AWS 活用のガードレール「IAM」の「Permissions Boundary」でアクセス境界を設定するには](https://atmarkit.itmedia.co.jp/ait/articles/2103/30/news018.html)

- IAM ユーザーや IAM ロールを発行する際に、その IAM ユーザーや IAM ロールが利用できる操作の範囲を制限する機能

  > 道の外に飛び出してしまわないための“ガードレール”を設置することで開発者の自由を損なわずに統制する

- **IAM エンティティが操作できる範囲は「IAM ポリシーで権限が付与されている」かつ「Permission Boundary で利用可能な範囲として定義されている権限」のみ**
- 具体的には：

  > IAM ユーザー自身の権限は IAM ポリシーで制御できますが、IAM ユーザーに IAM ロールを作成する権限を自由に許可することで、その IAM ユーザー自身以上の権限が許可された IAM ロールが作成され、EC2 や Lambda に設定されることで、IAM ユーザーは自身以上の権限で AWS の操作が行えます。

  この矛盾は解消したい。

  > IAM アクセス許可の境界を使用することで、IAM ユーザーは指定された権限範囲を超えるロールの作成ができなくなります。

  なるほど・・・

## AWS 管理ポリシー・カスタマー管理ポリシー

前述の通り

## ホワイトリストパターン・ブラックリストパターン

- ホワイトリストパターンは許可するものを定義すること、ブラックリストパターンは許可しないものを定義すること。
- つまり IAM はホワイトリスト方式。
